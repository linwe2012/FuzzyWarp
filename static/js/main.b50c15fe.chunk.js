(this["webpackJsonpfuzzy-warp"]=this["webpackJsonpfuzzy-warp"]||[]).push([[0],{15:function(t,e,n){t.exports=n(22)},20:function(t,e,n){},21:function(t,e,n){},22:function(t,e,n){"use strict";n.r(e);var a,r=n(3),o=n.n(r),i=n(11),s=n.n(i),c=(n(20),n(21),n(5)),l=n(0),u=n(2),h=function(){function t(e,n,a,r){var o=this;Object(l.a)(this,t),this.canvas=null,this.w=0,this.h=0,this.pickPosition={x:0,y:0},this.frame=null,this.clearPickPosition(),this.canvas=n,this.w=e.clientWidth,this.h=e.clientHeight,e.appendChild(n),e.mouseout=function(){return o.clearPickPosition()},this.frame=e,window.addEventListener("resize",(function(t){o.w=o.frame.clientWidth,o.h=o.frame.clientHeight,r(o.w,o.h)}))}return Object(u.a)(t,[{key:"Aspect",value:function(){return this.w/this.h}},{key:"getCanvasRelativePosition",value:function(t){var e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}},{key:"setPickPosition",value:function(t){var e=this.pickPosition,n=this.getCanvasRelativePosition(t);e.x=n.x/this.w*2-1,e.y=n.y/this.h*-2+1}},{key:"clearPickPosition",value:function(){var t=this.pickPosition;t.x=-1e5,t.y=-1e5}},{key:"onmousemove",set:function(t){this.frame.onmousemove=t}},{key:"onmousedown",set:function(t){this.frame.onmousedown=t}},{key:"onmouseup",set:function(t){this.frame.onmouseup=t}},{key:"onclick",set:function(t){this.frame.onclick=t}}]),t}(),f=n(1),v=n(12),d=(n(13),n(14)),m=n(6);function y(t,e,n,a){var r=n[0].clone().sub(n[1]),o=n[2].clone().sub(n[1]),i=a[0].clone().sub(a[1]),s=a[2].clone().sub(a[1]),c=r.angleTo(o),l=i.angleTo(s),u=r.length()*s.length(),h=i.length()*o.length();return t*(1-Math.abs(u-h)/(u+h))+e*(1-Math.abs(c-l)/2/Math.PI)}function w(t,e,n){var r=n.x-e.x,o=n.y-e.y,i=new Array;i[0]=new Array,i[0].push({dir:a.Start,cost:t[e.x][e.y]});for(var s=i[0][0].cost,c=1;c<o;++c)s+=t[e.x][e.y+c],i[0].push({dir:a.Start,cost:s});for(var l=1;l<r;++l){i[l]=new Array,i[l].push({dir:a.Start,cost:1/0});for(var u=1;u<o;++u){var h=i[l][u-1].cost,f=i[l-1][u-1].cost,v=t[e.x+l][e.y+u];h<f?i[l].push({dir:a.Left,cost:h+v}):i[l].push({dir:a.DownLeft,cost:f+v})}}for(var d=new Array,m={x:r-1,y:o-1},y=i[m.x][m.y].cost;(m.y||m.x!==e.x)&&(d.push(i[m.x][m.y].dir),i[m.x][m.y].dir===a.Left||--m.x,--m.y,i[m.x][m.y].dir!==a.Start););return d.shift(),[y,d]}function p(t,e,n,r){for(var o=n.length,i=r.length,s=new Array,l=0;l<o;++l){var u;s[l]=new Array;for(var h=0;h<i;++h){var f=(o+l-1)%o,v=(f+1)%o,d=(v+1)%o,p=(i+h-1)%i,k=(p+1)%i,g=(k+1)%i;s[l].push(1-y(t,e,[n[f],n[v],n[d]],[r[p],r[k],r[g]]))}(u=s[l]).push.apply(u,Object(m.a)(s[l]))}s.push(s[0]);for(var b=1/0,x=new Array,_=-1,P=0;P<o;++P){var T=w(s,{x:0,y:P},{x:o+1,y:P+i+1}),A=Object(c.a)(T,2),M=A[0],j=A[1];b>M&&(_=P,x=j,b=M)}for(var E=new Int32Array(i),O=o-1,I=0;I<i-1;++I){if(E[(_+(i-1-I))%i]=O,x[I]===a.DownLeft&&--O<0)break}return E[_%i]=0,E}!function(t){t[t.Left=0]="Left",t[t.DownLeft=1]="DownLeft",t[t.Start=2]="Start"}(a||(a={}));var k=function(t){var e=t[0].clone().sub(t[1]),n=t[2].clone().sub(t[1]),a=t[2].clone().sub(t[0]),r=e.angleTo(n),o=a.angleTo(n);return[o,r,Math.PI-r-o]};function g(t){return t[0].clone().sub(t[1]).add(t[2].clone().sub(t[1]))}function b(t){var e=t[0].clone().sub(t[1]),n=t[2].clone().sub(t[1]);return Math.abs(.5*e.length()*n.length()*Math.sin(e.angleTo(n)))}function x(t){for(var e=0,n=t.length-1,a=0;a<n;++a)e+=t[a].x*t[a+1].y-t[a].y*t[a+1].x;return e+=t[n].x*t[0].y-t[n].y*t[0].x,e/=2,Math.abs(e)}function _(t,e,n,a,r,o,i,s){var c=function(t,e,n,a){for(var r=0,o=0,i=0;i<3;++i){var s=n[i].clone().sub(n[(i+1)%3]).length(),c=a[i].clone().sub(a[(i+1)%3]).length();r+=Math.abs(s-c)/(s+c)}for(var l=k(n),u=k(a),h=0;h<3;++h)o+=Math.abs(l[h]-u[h]);return t*(1-r)+e*(1-(o/=Math.PI))}(a,r,i,s),l=g(i).angleTo(g(s)),u=(b(i)+b(s))/o;return u<.01?-1/0:t*c+e*(1-l/Math.PI)+n*u}function P(t,e,n,a){for(var r=new Array,o=0;o<e.length;++o)r[n[o]]=o;for(var i=new Array,s=a.smooth_a,c=a.smooth_b,l=a.smooth_c,u=a.smooth_w1,h=a.smooth_w2,f=x(t)+x(e),v=0;v<t.length;++v)for(var d=0;d<t.length;++d)for(var m=0;m<t.length;++m){var y=v,w=d%t.length,p=m%t.length;if(y!=d&&y!=m&&w!=v&&w!=m&&p!=v&&p!=d){var k=r[y],g=r[w],b=r[p],P=_(s,c,l,u,h,f,[e[k],e[g],e[b]],[t[y],t[w],t[p]]);i.push({val:P,idx:[k,g,b]})}}return i.sort((function(t,e){return e.val-t.val})),i[0].idx}var T=function(){function t(){Object(l.a)(this,t),this.data=new Array(4)}return Object(u.a)(t,[{key:"fromMatrix3",value:function(t){return this.data[0]=t.elements[0],this.data[1]=t.elements[1],this.data[2]=t.elements[3],this.data[3]=t.elements[4],this}},{key:"set",value:function(t,e,n,a){return this.data[0]=t,this.data[2]=e,this.data[1]=n,this.data[3]=a,this}},{key:"scaledIndentity",value:function(t){return this.set(t,0,0,t)}},{key:"det",value:function(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}},{key:"fromRotate",value:function(t){var e=this.data;return e[0]=Math.cos(t),e[1]=Math.sin(t),e[2]=-e[1],e[3]=e[0],this}},{key:"apply2Vector3",value:function(t){var e=t.x,n=t.y,a=this.data;return t.x=a[0]*e+a[2]*n,t.y=a[1]*e+a[3]*n,this}},{key:"decompose",value:function(){this.det();var e=new t,n=e.data,a=this.data;n[0]=1*a[3]+a[0],n[1]=-1*a[2]+a[1],n[2]=-1*a[1]+a[2],n[3]=1*a[0]+a[3];var r=n[0]*n[0]+n[1]*n[1];e.mulScalar(1/Math.sqrt(r));var o=(new t).inv(e),i=(new t).mul(o,this),s=n[0],c=n[1],l=Math.asin(Math.abs(c)),u=l;console.log("ref,",l),s>0&&c>0?u=l:c>0&&s<0?u=Math.PI-u:c<0&&s<0?u=Math.PI+u:c<0&&s>0&&(u=2*Math.PI-u),u>Math.PI&&(u-=2*Math.PI);var h=(new t).fromRotate(u);(new t).mul(h,i);return[u,i]}},{key:"inv",value:function(t){var e=1/t.det(),n=this.data,a=t.data;return n[0]=e*a[3],n[1]=-e*a[1],n[2]=-e*a[2],n[3]=e*a[0],this}},{key:"mul",value:function(t,e){var n=t.data,a=e.data,r=this.data;return r[0]=n[0]*a[0]+n[2]*a[1],r[1]=n[1]*a[0]+n[3]*a[1],r[2]=n[0]*a[2]+n[2]*a[3],r[3]=n[1]*a[2]+n[3]*a[3],this}},{key:"add",value:function(t){var e=t.data,n=this.data;return n[0]+=e[0],n[1]+=e[1],n[2]+=e[2],n[3]+=e[3],this}},{key:"clone",value:function(){var e=new t;return e.data=Object(m.a)(this.data),e}},{key:"mulScalar",value:function(t){return this.data[0]*=t,this.data[1]*=t,this.data[2]*=t,this.data[3]*=t,this}}]),t}();function A(t,e){var n=t[1].clone(),a=t[2].clone().sub(n),r=t[0].clone().sub(n),o=(new T).set(a.x,r.x,a.y,r.y),i=(new T).inv(o);return n.z=0,e.map((function(t){var e=t.clone().sub(n);return i.apply2Vector3(e),e}))}function M(t,e){var n=t[1].clone(),a=t[2].clone().sub(n),r=t[0].clone().sub(n),o=(new T).set(a.x,r.x,a.y,r.y);return n.z=0,e.map((function(t){var e=t.clone();return o.apply2Vector3(e),e.add(n),e}))}var j=function(){function t(){Object(l.a)(this,t),this.lookup=new Int32Array,this.keyPoints=new Array,this.T0_local=new Array,this.T1_local=new Array,this.Trans_T1_to_T0={translate:new f.r,theta:0,affine:new T,begin:new f.s,raw_transform:new f.i},this.T0=new Array,this.T1=new Array,this.referenceLocal=null}return Object(u.a)(t,[{key:"init",value:function(t,e,n){var a=this;this.T0=Object(m.a)(t),this.T1=Object(m.a)(e),this.lookup=p(n.sim_w1,n.sim_w2,t,e),this.keyPoints=P(t,e,this.lookup,n),console.log("lookup",this.lookup),console.log("key points",this.keyPoints);var r=this.keyPoints;this.T1_local=A([e[r[0]],e[r[1]],e[r[2]]],e),r=this.keyPoints.map((function(t){return a.lookup[t]})),this.T0_local=A([t[r[0]],t[r[1]],t[r[2]]],t),this.referenceLocal=[t[r[0]],t[r[1]],t[r[2]]];M([t[r[0]],t[r[1]],t[r[2]]],this.T0_local);var o=this.keyPoints;this.Trans_T1_to_T0=function(t,e){var n=function(t){var e=new f.i;return e.set(t[0].x,t[1].x,t[2].x,t[0].y,t[1].y,t[2].y,1,1,1),e},a=n(t),r=n(e),o=(new f.i).getInverse(a),i=(new f.i).multiplyMatrices(r,o),s=new f.r(i.elements[6],i.elements[7]),l=(new T).fromMatrix3(i).decompose(),u=Object(c.a)(l,2);return{raw_transform:i,translate:s,theta:u[0],affine:u[1],begin:t[1].clone()}}([e[o[0]],e[o[1]],e[o[2]]],[t[r[0]],t[r[1]],t[r[2]]]);var i=this.Trans_T1_to_T0,s=(new T).scaledIndentity(0),l=(new T).fromRotate(1*i.theta),u=i.affine.clone().mulScalar(1),h=(new T).mul(l,u);s.add(h);this.keyPoints.map((function(t){var e=a.T1[t].clone();return s.apply2Vector3(e),e})).map((function(t){var e=t.clone();return e.add(new f.s(i.translate.x,i.translate.y)),e})),this.keyPoints.map((function(t){var e=a.T1[t].clone();return e.z=1,e.applyMatrix3(i.raw_transform),e}));console.log(this.Trans_T1_to_T0)}},{key:"_interpLocal",value:function(t){var e=this;return this.T1_local.map((function(n,a){var r=n.clone().multiplyScalar(1-t).add(e.T0_local[e.lookup[a]].clone().multiplyScalar(t));return r.z=n.z,r}))}},{key:"interp",value:function(t){var e=this,n=this.Trans_T1_to_T0,a=(new T).scaledIndentity(1-t),r=(new T).fromRotate(t*n.theta),o=n.affine.clone().mulScalar(t),i=(new T).mul(r,o);a.add(i);var s,c=this.keyPoints.map((function(t){var n=e.T1[t].clone();return a.apply2Vector3(n),n})),l=Object(d.a)(c);try{for(l.s();!(s=l.n()).done;){s.value.add(new f.s(n.translate.x*t,n.translate.y*t))}}catch(u){l.e(u)}finally{l.f()}return M(c,this._interpLocal(t))}}]),t}();var E=function(t){var e=Object(r.useState)(),n=Object(c.a)(e,2),a=n[0],i=n[1],s=Object(r.useState)("A"),l=Object(c.a)(s,2),u=l[0],d=l[1];Object(r.useEffect)((function(){i(function(){var t=document.getElementById("canvas-frame");if(null===t)return;var e=new f.q,n=new f.t({antialias:!0,powerPreference:"high-performance"}),a=new h(t,n.domElement,n,(function(){o()})),r=new f.l(75,a.Aspect(),.1,1e3);n.setSize(a.w,a.h),n.setClearColor(4473924,1),r.position.z=5;var o=function(){console.log(a.w,a.h)},i=new v.a(r,t);i.target.set(0,0,0),i.rotateSpeed=8,i.noPan=!1,i.maxDistance=60,i.keys=[];var s=new f.a(4210752);e.add(s);var c=new f.n(16777215,1,100);c.position.set(10,10,10),e.add(c);var l=new f.n(16777215,1,200);l.position.set(-40,20,20),e.add(l);var u=new f.n(16777215,1,200);u.position.set(-40,-20,-20),e.add(u);var d=new f.n(16777215,1,200);d.position.set(-20,10,-10),e.add(d);var m=new j,y=new f.m(1e3,1e3,10,10),w=new f.j(y,new f.k);w.position.set(0,0,0);var p=new f.p,k=new f.e;e.add(k);var g=function(t){var e=new f.d;e.vertices=t;var n=new f.g({color:16777215,linewidth:1});return new f.f(e,n)},b=new Array,x=g(b),_=new Array,P=g(_);e.add(x);var T=!1;a.onclick=function(t){a.setPickPosition(t);var n=function(){var t=new f.s(a.pickPosition.x,a.pickPosition.y,5);return p.setFromCamera(t,r),p.intersectObject(w,!0)[0].point}();n.z=0,Math.abs(n.y)>3.71||(T?(_.push(n),e.remove(P),P=g(_),e.add(P)):(b.push(n),e.remove(x),x=g(b),e.add(x)))};var A=!1,M=0,E=g(new Array);e.add(E);var O=new f.e;e.add(O);var I=function(t){[16711680,65280,255].map((function(e,n){var a=new f.k({color:e}),r=new f.b(.06,10),o=new f.j(r,a);o.position.set(t[n].x,t[n].y,t[n].z),O.add(o)}))};return function t(){if(requestAnimationFrame(t),n.render(e,r),A)if(M>1)A=!1;else{M+=.01,e.remove(E);var a=m.interp(M);a.push(a[0]),E=g(a),e.add(E)}}(),{next:function(){return(T=!T)?"B":"A"},transform:function(){m.init(b,_,{smooth_a:.2,smooth_b:.3,smooth_c:.5,smooth_w1:.5,smooth_w2:.5,sim_w1:.5,sim_w2:.5}),I(m.keyPoints.map((function(t){return _[t]}))),I(m.keyPoints.map((function(t){return b[m.lookup[t]]}))),A=!0,M=0}}}())}),[]);return o.a.createElement("div",null,"using: ",u,o.a.createElement("button",{onClick:function(){a&&d(a.next())}},"Toggle"),o.a.createElement("button",{onClick:function(){a&&a.transform()}},"Transform"))};var O=function(){return o.a.createElement("div",{className:"App",style:{display:"flex"}},o.a.createElement("div",{className:"canvas",id:"canvas-frame",style:{width:800,height:600}},o.a.createElement(E,null)),o.a.createElement("div",{style:{marginLeft:10,textAlign:"left"}},o.a.createElement("p",null,"Usage: "),o.a.createElement("li",null," Click on gray area to make 1st shape "),o.a.createElement("li",null," Click toggle to make 2nd shape, ",o.a.createElement("em",null,"Make sure 2nd shape has more vertices than first one")," "),o.a.createElement("li",null," Click tranform to see the transform "),o.a.createElement("li",null," refresh page to try new transfroms ")))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[15,1,2]]]);
//# sourceMappingURL=main.b50c15fe.chunk.js.map