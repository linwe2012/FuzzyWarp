(this["webpackJsonpfuzzy-warp"]=this["webpackJsonpfuzzy-warp"]||[]).push([[0],{23:function(t,e,n){},24:function(t,e,n){},25:function(t,e,n){},26:function(t,e,n){"use strict";n.r(e);var a,s=n(1),r=n(5),i=n(14),o=n.n(i),c=(n(23),n(6)),h=(n(24),n(4)),l=n(12),u=n(0),d=n(3),m=function(){function t(e,n,a,s){var r=this;Object(u.a)(this,t),this.canvas=null,this.w=0,this.h=0,this.pickPosition={x:0,y:0},this.frame=null,this.clearPickPosition(),this.canvas=n,this.w=e.clientWidth,this.h=e.clientHeight,e.appendChild(n),e.mouseout=function(){return r.clearPickPosition()},this.frame=e,window.addEventListener("resize",(function(t){r.w=r.frame.clientWidth,r.h=r.frame.clientHeight,s(r.w,r.h)}))}return Object(d.a)(t,[{key:"Aspect",value:function(){return this.w/this.h}},{key:"getCanvasRelativePosition",value:function(t){var e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}},{key:"setPickPosition",value:function(t){var e=this.pickPosition,n=this.getCanvasRelativePosition(t);e.x=n.x/this.w*2-1,e.y=n.y/this.h*-2+1}},{key:"clearPickPosition",value:function(){var t=this.pickPosition;t.x=-1e5,t.y=-1e5}},{key:"onmousemove",set:function(t){this.frame.onmousemove=t}},{key:"onmousedown",set:function(t){this.frame.onmousedown=t}},{key:"onmouseup",set:function(t){this.frame.onmouseup=t}},{key:"onclick",set:function(t){this.frame.onclick=t}}]),t}(),f=n(2),v=n(15),p=(n(16),n(17)),j=n(8);function b(t,e,n,a){var s=n[0].clone().sub(n[1]),r=n[2].clone().sub(n[1]),i=a[0].clone().sub(a[1]),o=a[2].clone().sub(a[1]),c=s.angleTo(r),h=i.angleTo(o),l=s.length()*o.length(),u=i.length()*r.length();return t*(1-Math.abs(l-u)/(l+u))+e*(1-Math.abs(c-h)/2/Math.PI)}function w(t,e,n){var s=n.x-e.x,r=n.y-e.y,i=new Array;i[0]=new Array,i[0].push({dir:a.Start,cost:t[e.x][e.y]});for(var o=i[0][0].cost,c=1;c<r;++c)o+=t[e.x][e.y+c],i[0].push({dir:a.Start,cost:o});for(var h=1;h<s;++h){i[h]=new Array,i[h].push({dir:a.Start,cost:1/0});for(var l=1;l<r;++l){var u=i[h][l-1].cost,d=i[h-1][l-1].cost,m=t[e.x+h][e.y+l];u<d?i[h].push({dir:a.Left,cost:u+m}):i[h].push({dir:a.DownLeft,cost:d+m})}}for(var f=new Array,v={x:s-1,y:r-1},p=i[v.x][v.y].cost;(v.y||v.x!==e.x)&&(f.push(i[v.x][v.y].dir),i[v.x][v.y].dir===a.Left||--v.x,--v.y,i[v.x][v.y].dir!==a.Start););return f.shift(),[p,f]}function y(t,e,n,s){for(var r=n.length,i=s.length,o=new Array,h=0;h<r;++h){var l;o[h]=new Array;for(var u=0;u<i;++u){var d=(r+h-1)%r,m=(d+1)%r,f=(m+1)%r,v=(i+u-1)%i,p=(v+1)%i,y=(p+1)%i;o[h].push(1-b(t,e,[n[d],n[m],n[f]],[s[v],s[p],s[y]]))}(l=o[h]).push.apply(l,Object(j.a)(o[h]))}o.push(o[0]);for(var x=1/0,O=new Array,g=-1,_=0;_<r;++_){var k=w(o,{x:0,y:_},{x:r+1,y:_+i+1}),P=Object(c.a)(k,2),T=P[0],A=P[1];x>T&&(g=_,O=A,x=T)}for(var M=new Int32Array(i),z=r-1,S=0;S<i-1;++S){if(M[(g+(i-1-S))%i]=z,O[S]===a.DownLeft&&--z<0)break}return M[g%i]=0,M}!function(t){t[t.Left=0]="Left",t[t.DownLeft=1]="DownLeft",t[t.Start=2]="Start"}(a||(a={}));var x=function(t){var e=t[0].clone().sub(t[1]),n=t[2].clone().sub(t[1]),a=t[2].clone().sub(t[0]),s=e.angleTo(n),r=a.angleTo(n);return[r,s,Math.PI-s-r]};function O(t){return t[0].clone().sub(t[1]).add(t[2].clone().sub(t[1]))}function g(t){var e=t[0].clone().sub(t[1]),n=t[2].clone().sub(t[1]);return Math.abs(.5*e.length()*n.length()*Math.sin(e.angleTo(n)))}function _(t){for(var e=0,n=t.length-1,a=0;a<n;++a)e+=t[a].x*t[a+1].y-t[a].y*t[a+1].x;return e+=t[n].x*t[0].y-t[n].y*t[0].x,e/=2,Math.abs(e)}function k(t,e,n,a,s,r,i,o,c){var h=function(t,e,n,a){for(var s=0,r=0,i=0;i<3;++i){var o=n[i].clone().sub(n[(i+1)%3]).length(),c=a[i].clone().sub(a[(i+1)%3]).length();s+=Math.abs(o-c)/(o+c)}for(var h=x(n),l=x(a),u=0;u<3;++u)r+=Math.abs(h[u]-l[u]);return t*(1-s)+e*(1-r/Math.PI)}(s,r,o,c),l=O(o).angleTo(O(c)),u=(g(o)+g(c))/i;return u<.01?-1/0:t*h+e*(1-l/Math.PI)+n*(u/(u+a))}function P(t,e,n,a){for(var s=new Array,r=0;r<e.length;++r)s[n[r]]=r;for(var i=new Array,o=a.smooth_a,c=a.smooth_b,h=a.smooth_c,l=a.smooth_d,u=a.smooth_w1,d=a.smooth_w2,m=_(t)+_(e),f=0;f<t.length;++f)for(var v=0;v<t.length;++v)for(var p=0;p<t.length;++p){var j=f,b=v%t.length,w=p%t.length;if(j!==v&&j!==p&&b!==f&&b!==p&&w!==f&&w!==v){var y=s[j],x=s[b],O=s[w],g=k(o,c,h,l,u,d,m,[e[y],e[x],e[O]],[t[j],t[b],t[w]]);i.push({val:g,idx:[y,x,O]})}}return i.sort((function(t,e){return e.val-t.val})),i[0].idx}var T=function(){function t(){Object(u.a)(this,t),this.data=new Array(4)}return Object(d.a)(t,[{key:"fromMatrix3",value:function(t){return this.data[0]=t.elements[0],this.data[1]=t.elements[1],this.data[2]=t.elements[3],this.data[3]=t.elements[4],this}},{key:"set",value:function(t,e,n,a){return this.data[0]=t,this.data[2]=e,this.data[1]=n,this.data[3]=a,this}},{key:"scaledIndentity",value:function(t){return this.set(t,0,0,t)}},{key:"det",value:function(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}},{key:"fromRotate",value:function(t){var e=this.data;return e[0]=Math.cos(t),e[1]=Math.sin(t),e[2]=-e[1],e[3]=e[0],this}},{key:"apply2Vector3",value:function(t){var e=t.x,n=t.y,a=this.data;return t.x=a[0]*e+a[2]*n,t.y=a[1]*e+a[3]*n,this}},{key:"decompose",value:function(){var e=new t,n=e.data,a=this.data;n[0]=1*a[3]+a[0],n[1]=-1*a[2]+a[1],n[2]=-1*a[1]+a[2],n[3]=1*a[0]+a[3];var s=n[0]*n[0]+n[1]*n[1];e.mulScalar(1/Math.sqrt(s));var r=(new t).inv(e),i=(new t).mul(r,this),o=n[0],c=n[1],h=Math.asin(Math.abs(c)),l=h;console.log("ref,",h),o>0&&c>0?l=h:c>0&&o<0?l=Math.PI-l:c<0&&o<0?l=Math.PI+l:c<0&&o>0&&(l=2*Math.PI-l),l>Math.PI&&(l-=2*Math.PI);var u=(new t).fromRotate(l);(new t).mul(u,i);return[l,i]}},{key:"inv",value:function(t){var e=1/t.det(),n=this.data,a=t.data;return n[0]=e*a[3],n[1]=-e*a[1],n[2]=-e*a[2],n[3]=e*a[0],this}},{key:"mul",value:function(t,e){var n=t.data,a=e.data,s=this.data;return s[0]=n[0]*a[0]+n[2]*a[1],s[1]=n[1]*a[0]+n[3]*a[1],s[2]=n[0]*a[2]+n[2]*a[3],s[3]=n[1]*a[2]+n[3]*a[3],this}},{key:"add",value:function(t){var e=t.data,n=this.data;return n[0]+=e[0],n[1]+=e[1],n[2]+=e[2],n[3]+=e[3],this}},{key:"clone",value:function(){var e=new t;return e.data=Object(j.a)(this.data),e}},{key:"mulScalar",value:function(t){return this.data[0]*=t,this.data[1]*=t,this.data[2]*=t,this.data[3]*=t,this}}]),t}();function A(t,e){var n=t[1].clone(),a=t[2].clone().sub(n),s=t[0].clone().sub(n),r=(new T).set(a.x,s.x,a.y,s.y),i=(new T).inv(r);return n.z=0,e.map((function(t){var e=t.clone().sub(n);return i.apply2Vector3(e),e}))}function M(t,e){var n=t[1].clone(),a=t[2].clone().sub(n),s=t[0].clone().sub(n),r=(new T).set(a.x,s.x,a.y,s.y);return n.z=0,e.map((function(t){var e=t.clone();return r.apply2Vector3(e),e.add(n),e}))}var z=function(){function t(){Object(u.a)(this,t),this.lookup=new Int32Array,this.keyPoints=new Array,this.T0_local=new Array,this.T1_local=new Array,this.Trans_T1_to_T0={translate:new f.r,theta:0,affine:new T,begin:new f.s,raw_transform:new f.i},this.T0=new Array,this.T1=new Array,this.referenceLocal=null}return Object(d.a)(t,[{key:"init",value:function(t,e,n){var a=this;this.T0=Object(j.a)(t),this.T1=Object(j.a)(e),this.lookup=y(n.sim_w1,n.sim_w2,t,e),this.keyPoints=P(t,e,this.lookup,n),console.log("lookup",this.lookup),console.log("key points",this.keyPoints);var s=this.keyPoints;this.T1_local=A([e[s[0]],e[s[1]],e[s[2]]],e),s=this.keyPoints.map((function(t){return a.lookup[t]})),this.T0_local=A([t[s[0]],t[s[1]],t[s[2]]],t),this.referenceLocal=[t[s[0]],t[s[1]],t[s[2]]];M([t[s[0]],t[s[1]],t[s[2]]],this.T0_local);var r=this.keyPoints;this.Trans_T1_to_T0=function(t,e){var n=function(t){var e=new f.i;return e.set(t[0].x,t[1].x,t[2].x,t[0].y,t[1].y,t[2].y,1,1,1),e},a=n(t),s=n(e),r=a.clone().invert(),i=(new f.i).multiplyMatrices(s,r),o=new f.r(i.elements[6],i.elements[7]),h=(new T).fromMatrix3(i).decompose(),l=Object(c.a)(h,2);return{raw_transform:i,translate:o,theta:l[0],affine:l[1],begin:t[1].clone()}}([e[r[0]],e[r[1]],e[r[2]]],[t[s[0]],t[s[1]],t[s[2]]]);var i=this.Trans_T1_to_T0,o=(new T).scaledIndentity(0),h=(new T).fromRotate(1*i.theta),l=i.affine.clone().mulScalar(1),u=(new T).mul(h,l);o.add(u);this.keyPoints.map((function(t){var e=a.T1[t].clone();return o.apply2Vector3(e),e})).map((function(t){var e=t.clone();return e.add(new f.s(i.translate.x,i.translate.y)),e})),this.keyPoints.map((function(t){var e=a.T1[t].clone();return e.z=1,e.applyMatrix3(i.raw_transform),e}));console.log(this.Trans_T1_to_T0)}},{key:"_interpLocal",value:function(t){var e=this;return this.T1_local.map((function(n,a){var s=n.clone().multiplyScalar(1-t).add(e.T0_local[e.lookup[a]].clone().multiplyScalar(t));return s.z=n.z,s}))}},{key:"interp",value:function(t){var e=this,n=this.Trans_T1_to_T0,a=(new T).scaledIndentity(1-t),s=(new T).fromRotate(t*n.theta),r=n.affine.clone().mulScalar(t),i=(new T).mul(s,r);a.add(i);var o,c=this.keyPoints.map((function(t){var n=e.T1[t].clone();return a.apply2Vector3(n),n})),h=Object(p.a)(c);try{for(h.s();!(o=h.n()).done;){o.value.add(new f.s(n.translate.x*t,n.translate.y*t))}}catch(l){h.e(l)}finally{h.f()}return M(c,this._interpLocal(t))}}]),t}();var S=function(t){var e=Object(r.useState)({smooth_a:.4,smooth_b:.4,smooth_c:.2,smooth_d:2,smooth_w1:.5,smooth_w2:.5,sim_w1:.5,sim_w2:.5}),n=Object(c.a)(e,2),a=n[0],i=n[1],o=function(e){return function(n){var s=parseFloat(n.target.value),r=Object(l.a)({},a);if("sim_w1"===e&&(r.sim_w1=s,r.sim_w2=1-s),"smooth_w1"===e&&(r.smooth_w1=s,r.smooth_w2=1-s),"smooth_a"===e||"smooth_b"===e){r[e]=s;var o=r.smooth_a+r.smooth_b;if(o>1)return;r.smooth_c=1-o}var c=Object(l.a)(Object(l.a)({},r),{},Object(h.a)({},e,s));i(c),t.handle&&t.handle.setDefaultParameter(c)}};return Object(s.jsxs)("div",{children:[Object(s.jsx)("h4",{children:"Fuzzy polygon similarity"}),Object(s.jsxs)("p",{children:[Object(s.jsxs)("span",{children:["\u03c9 ",Object(s.jsx)("sub",{children:"1"})," (match size) "]}),Object(s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",defaultValue:a.sim_w1,onChange:o("sim_w1")})," ",a.sim_w1," "]}),Object(s.jsxs)("p",{children:[Object(s.jsxs)("span",{children:["\u03c9 ",Object(s.jsx)("sub",{children:"2"})," (match shape)"]}),Object(s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:a.sim_w2,readOnly:!0})," ",a.sim_w2," "]}),Object(s.jsx)("h4",{children:"Affine Transform Smooth Param"}),Object(s.jsx)("h5",{children:"Similarity Degree"}),Object(s.jsxs)("p",{children:[Object(s.jsxs)("span",{children:["\u03c9 ",Object(s.jsx)("sub",{children:"1"})," (match size) "]}),Object(s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",defaultValue:a.smooth_w1,onChange:o("smooth_w1")})," ",a.smooth_w1," "]}),Object(s.jsxs)("p",{children:[Object(s.jsxs)("span",{children:["\u03c9 ",Object(s.jsx)("sub",{children:"2"})," (match shape)"]}),Object(s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:a.smooth_w2,readOnly:!0})," ",a.smooth_w2.toFixed(2)," "]}),Object(s.jsx)("h5",{children:"Smooth"}),Object(s.jsxs)("p",{children:[Object(s.jsxs)("span",{children:["smooth",Object(s.jsx)("sub",{children:"a"})," (match similarity) "]}),Object(s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:a.smooth_a,onChange:o("smooth_a")})," ",a.smooth_a," "]}),Object(s.jsxs)("p",{children:[Object(s.jsxs)("span",{children:["smooth",Object(s.jsx)("sub",{children:"b"})," (minimize rotation) "]}),Object(s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:a.smooth_b,onChange:o("smooth_b")})," ",a.smooth_b," "]}),Object(s.jsxs)("p",{children:[Object(s.jsxs)("span",{children:["smooth",Object(s.jsx)("sub",{children:"c"})," (minimize area) "]}),Object(s.jsx)("input",{type:"range",min:"0",max:"1",step:"0.01",value:a.smooth_c,readOnly:!0})," ",a.smooth_c.toFixed(2)," "]}),Object(s.jsxs)("p",{children:[Object(s.jsxs)("span",{children:["smooth",Object(s.jsx)("sub",{children:"d"})," (adjust) "]}),Object(s.jsx)("input",{type:"range",min:"0",max:"20",step:"0.1",value:a.smooth_d,onChange:o("smooth_d")})," ",a.smooth_d," "]})]})},C=function(t){var e=Object(r.useState)(),n=Object(c.a)(e,2),a=n[0],i=n[1],o=Object(r.useState)("A"),h=Object(c.a)(o,2),l=h[0],u=h[1];Object(r.useEffect)((function(){var e=function(){var t=function(){i()},e=document.getElementById("canvas-frame");if(null===e)return;var n=new f.q,a=new f.t({antialias:!0,powerPreference:"high-performance"}),s=new m(e,a.domElement,a,t),r=new f.l(75,s.Aspect(),.1,1e3);a.setSize(s.w,s.h),a.setClearColor(4473924,1),a.setPixelRatio(window.devicePixelRatio),r.position.z=5;var i=function(){console.log(s.w,s.h)},o=new v.a(r,e);o.target.set(0,0,0),o.rotateSpeed=8,o.noPan=!1,o.maxDistance=60,o.keys=[];var c=new f.a(4210752);n.add(c);var h=new f.n(16777215,1,100);h.position.set(10,10,10),n.add(h);var l=new f.n(16777215,1,200);l.position.set(-40,20,20),n.add(l);var u=new f.n(16777215,1,200);u.position.set(-40,-20,-20),n.add(u);var d=new f.n(16777215,1,200);d.position.set(-20,10,-10),n.add(d);var p=new z,j=new f.m(1e3,1e3,10,10),b=new f.j(j,new f.k);b.position.set(0,0,0);var w=new f.p,y=function(){var t=new f.s(s.pickPosition.x,s.pickPosition.y,5);return w.setFromCamera(t,r),w.intersectObject(b,!0)[0].point},x=new f.e;n.add(x);var O=function(t){var e=new f.d;e.vertices=t;var n=new f.g({color:16777215,linewidth:1});return new f.f(e,n)},g=new Array,_=O(g),k=new Array,P=O(k);n.add(_);var T=!1;s.onclick=function(t){s.setPickPosition(t);var e=y();e.z=0,Math.abs(e.y)>3.71||(T?(k.push(e),n.remove(P),P=O(k),n.add(P)):(g.push(e),n.remove(_),_=O(g),n.add(_)))};var A=!1,M=0,S=.01,C=O(new Array);function I(){if(requestAnimationFrame(I),a.render(n,r),A)if(M>1)A=!1;else{M+=S,n.remove(C);var t=p.interp(M);t.push(t[0]),C=O(t),n.add(C)}}n.add(C);var L=new f.e;n.add(L);var R=function(t){[16711680,65280,255].forEach((function(e,n){var a=new f.k({color:e}),s=new f.b(.06,10),r=new f.j(s,a);r.position.set(t[n].x,t[n].y,t[n].z),L.add(r)}))},D={smooth_a:.4,smooth_b:.4,smooth_c:.2,smooth_d:2,smooth_w1:.5,smooth_w2:.5,sim_w1:.5,sim_w2:.5},N=function(t){if(g.length>k.length){var e=g;g=k,k=e}L.clear(),p.init(g,k,t||D),R(p.keyPoints.map((function(t){return k[t]}))),R(p.keyPoints.map((function(t){return g[p.lookup[t]]}))),A=!0,M=0};return I(),{next:function(){return(T=!T)?"B":"A"},transform:function(t){N(t)},setDefaultParameter:function(t){D=t}}}();i(e),t.onHandle&&t.onHandle(e)}),[]);return Object(s.jsxs)("div",{children:["using: ",l,Object(s.jsx)("button",{onClick:function(){a&&u(a.next())},children:"Toggle"}),Object(s.jsx)("button",{onClick:function(){a&&a.transform()},children:"Transform"})]})};n(25);var I=function(){return Object(s.jsx)("a",{href:"https://linwe2012.github.io/personal-page",children:Object(s.jsxs)("div",{className:"personal-page-wrap-white",children:[Object(s.jsx)("img",{className:"personal-page-avatar-white",src:"https://linwe2012.github.io/personal-page/static/img/me-removebg-preview-sqr.svg",alt:""}),Object(s.jsx)("div",{className:"personal-page-text-white",children:"Lin's Personal Page"})]})})},L=function(){var t=Object(r.useState)(void 0),e=Object(c.a)(t,2),n=e[0],a=e[1];return Object(s.jsxs)("div",{className:"App",style:{display:"flex"},children:[Object(s.jsx)("div",{className:"canvas",id:"canvas-frame",style:{width:800,height:600},children:Object(s.jsx)(C,{onHandle:function(t){return a(t)}})}),Object(s.jsxs)("div",{style:{marginLeft:10,textAlign:"left"},children:[Object(s.jsx)("h3",{children:"Usage: "}),Object(s.jsx)("li",{children:" Click on the gray area to make 1st shape "}),Object(s.jsx)("li",{children:" Click toggle button, then you can make 2nd shape "}),Object(s.jsx)("li",{children:" Click tranform to see the animation "}),Object(s.jsx)("li",{children:" refresh page to try new transfroms "}),Object(s.jsx)("div",{className:"seperator"}),Object(s.jsx)("h3",{children:"Parameters: "}),Object(s.jsx)(S,{handle:n}),Object(s.jsx)("div",{className:"seperator"}),Object(s.jsx)("h3",{children:" Note: "}),Object(s.jsx)("li",{children:" The 3 dots, blue, green, red indicates the reference points, This can be changed via Fuzzy polygon similarity. "}),Object(s.jsx)(I,{})]})]})};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(Object(s.jsx)(L,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.695ae807.chunk.js.map