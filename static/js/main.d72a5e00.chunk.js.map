{"version":3,"sources":["algo.ts","canvas.js","render.tsx","personal_page.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["DPDirection","CanvasManager","frame","canvas","render","onresize","w","h","pickPosition","x","y","this","clearPickPosition","clientWidth","clientHeight","appendChild","mouseout","window","addEventListener","e","event","rect","getBoundingClientRect","clientX","left","clientY","top","pos","getCanvasRelativePosition","fn","onmousemove","onmousedown","onmouseup","onclick","sim_t","w1","w2","t0","t1","e_0_1","clone","sub","e_0_2","e_1_1","e_1_2","a_0_1","angleTo","a_1_1","a","length","b","Math","abs","PI","dpMinPath","graph","from","to","m","n","dp","Array","push","dir","Start","cost","sum","j","i","Infinity","downLeft","cur","Left","DownLeft","pathDir","min","shift","fuzzySimGraph","T0","T1","len0","len1","a0","b0","c0","a1","b1","c1","the_i","this_min","this_pathDir","lookup","Int32Array","mapped","getTriAngles","t","e0","e1","e2","bisect","add","area","v1","v2","sin","polygonArea","poly","end","smooth_a","c","d","poly_area_sum","S","smoothS","R","A","smoothKeyPoints","params","reverse_lookup","smooth","smooth_b","smooth_c","smooth_d","smooth_w1","smooth_w2","area_sum","k","u0","v0","w0","u","v","s","val","idx","sort","Mat2","data","elements","n11","n12","n21","n22","set","theta","cos","B","div","mulScalar","sqrt","Bi","inv","C","mul","ref","asin","console","log","U","fromRotate","M","det_","det","global2LocalCoords","vecs","V","Mi","z","map","apply2Vector3","local2GlobalCoords","FuzzyWarp","keyPoints","T0_local","T1_local","Trans_T1_to_T0","translate","Vector2","affine","begin","Vector3","raw_transform","Matrix3","referenceLocal","sim_w1","sim_w2","k1","t2m","mt","mFrom","mTo","inverse","invert","transform","multiplyMatrices","fromMatrix3","decompose","computeTransform","trans","A0","scaledIndentity","B0","C0","D0","applyMatrix3","multiplyScalar","newGlobalCoords","_interpLocal","RenderSettings","props","useState","setParams","chParam","res","parseFloat","target","value","nparam","rprams","handle","setDefaultParameter","type","max","step","defaultValue","onChange","readOnly","toFixed","Render","setHandle","useWhat","setUseWhat","useEffect","HandleResize","Resize","document","getElementById","scene","THREE","renderer","antialias","powerPreference","domElement","camera","Aspect","setSize","setClearColor","setPixelRatio","devicePixelRatio","position","control","TrackballControls","rotateSpeed","noPan","maxDistance","keys","ambientLight","light","plight","light1","light2","fuzzyWarper","planegeo","planeMesh","click_raycaster","GetMouseOnPlane","point","setFromCamera","intersectObject","dotsGroup","makeLineFromVertices","A_lineGeo","vertices","A_lineMaterial","color","linewidth","A_vertices","A_line","B_vertices","B_line","useAorB","setPickPosition","pointOnPlane","remove","isTransforming","time","deltaTime","middle","requestAnimationFrame","inted","interp","addDots","vec","forEach","mat","geo","defaultFuzzyParams","triggerTransform","T","clear","init","next","RunAll","onHandle","onClick","PersonalPage","href","className","src","alt","App","undefined","style","display","id","width","height","marginLeft","textAlign","Boolean","location","hostname","match","ReactDOM","navigator","serviceWorker","ready","then","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.d72a5e00.chunk.js","sourcesContent":["import {Vector3, Matrix3, Vector2} from 'three'\n\ntype TriangleVec = [Vector3, Vector3, Vector3]\n\nexport interface FuzzyParams {\n    smooth_a: number\n    smooth_b: number\n    smooth_c: number\n    smooth_d: number\n    smooth_w1: number\n    smooth_w2: number\n\n    // constraint: sim_w1 + sim_w2 = 1\n    sim_w1: number\n    sim_w2: number\n}\n\n\nfunction sim_t(w1:number, w2: number, \n    t0: TriangleVec, t1: TriangleVec) {\n    \n    let e_0_1 = t0[0].clone().sub(t0[1])\n    let e_0_2 = t0[2].clone().sub(t0[1])\n\n    let e_1_1 = t1[0].clone().sub(t1[1])\n    let e_1_2 = t1[2].clone().sub(t1[1])\n\n    const a_0_1 = e_0_1.angleTo(e_0_2)\n    const a_1_1 = e_1_1.angleTo(e_1_2)\n\n    const a = e_0_1.length() * e_1_2.length()\n    const b = e_1_1.length() * e_0_2.length()\n    const nom =  Math.abs(a-b)\n    const denom = a+b\n\n    const angle = Math.abs(a_0_1 - a_1_1) / 2.0 / Math.PI\n\n    return w1*(1-nom/denom) + w2*(1-angle)\n}\n\nfunction sim_p(w1: number, w2:number, T0: Vector3[], T1: Vector3[]) {\n    const end = T0.length - 2\n    let sum = 0;\n\n    for(let i = 0; i < end; ++i) {\n        sum += sim_t(w1, w2, \n            [T0[i], T0[i+1], T0[i+2]],\n            [T1[i], T1[i+1], T1[i+2]]\n        )\n    }\n\n    // Now we tackle the boundries:\n    sum += sim_t(w1, w2, \n        [T0[end], T0[end+1], T0[0]],\n        [T1[end], T1[end+1], T1[0]]\n    )\n\n    //TODO: I really dont know which number to devide the sum,\n    // but it won't effect the final result at all\n    sum /= (T0.length)\n    return sum;\n}\n\n\n// DP find Min path\n// ------------------------------\nenum DPDirection {\n    Left,\n    DownLeft,\n    Start\n}\n\ninterface DPInfo {\n    dir: DPDirection\n    cost: number\n}\n\ninterface Position2D {\n    x: number\n    y: number\n}\n\nfunction dpMinPath(graph:number[][], from: Position2D, to: Position2D) : [number, DPDirection[]] {\n    const m = to.x - from.x;\n    const n = to.y - from.y;\n\n    const dp = new Array<Array<DPInfo>>();\n    // initialize values for DP\n    dp[0] = new Array<DPInfo>();\n    dp[0].push({\n        dir: DPDirection.Start,\n        cost: graph[from.x][from.y]\n    })\n\n    {\n        let sum = dp[0][0].cost\n        for(let j = 1; j < n; ++j) {\n            sum += graph[from.x][from.y + j]\n            dp[0].push({\n                dir: DPDirection.Start,\n                cost: sum\n            })\n        }\n    }\n\n    // compute all possible path\n    for(let i = 1; i < m; ++i) {\n        dp[i] = new Array<DPInfo>();\n        dp[i].push({\n            dir: DPDirection.Start,\n            cost: Infinity\n        })\n\n        for(let j = 1; j < n; ++j) {\n            const left = dp[i][j-1].cost\n            const downLeft = dp[i-1][j-1].cost;\n            const cur = graph[from.x+i][from.y+j]\n            if(left < downLeft) {\n                dp[i].push({\n                    dir: DPDirection.Left,\n                    cost: left + cur\n                })\n            }\n            else {\n                dp[i].push({\n                    dir: DPDirection.DownLeft,\n                    cost: downLeft + cur\n                })\n            }\n        }\n    }\n\n    // reconstruct path\n    const pathDir = new Array<DPDirection>();\n    let pos: Position2D = {\n        x: m - 1,\n        y: n - 1\n    }\n    const min = dp[pos.x][pos.y].cost;\n\n    while(pos.y || pos.x !== from.x) {\n        pathDir.push(dp[pos.x][pos.y].dir)\n        \n        if(dp[pos.x][pos.y].dir === DPDirection.Left) {\n            --pos.y\n        }\n        else {\n            --pos.x;\n            --pos.y;\n        }\n        if(dp[pos.x][pos.y].dir === DPDirection.Start) {\n            break;\n        }\n        // console.assert(pos.x >=0 && pos.y <= 0, \"DP failed: Out of Boundry\")\n    }\n    pathDir.shift();\n    return [min, pathDir]\n}\n\n\n\n// Use sim graph to compute a onto (surjection) mapping from T1 to T0\n// assumes: T0.len < T1.len\nfunction fuzzySimGraph(w1: number, w2:number, T0: Vector3[], T1: Vector3[]) {\n    // we extend (m + 2) x (n + 2) graphG to (m + 2) x (2 x (n + 2)-1) \n    // EG[i, j] = G[i, j mod(n + l)],\n    //const m = T0.length + 1\n    //const n = 2*(T1.length + 1)\n\n    // Part I: Compute fuzzy Graph\n    // ------------------------------\n    const len0 = T0.length\n    const len1 = T1.length\n\n    const graph = new Array<Array<number>>();\n\n\n    // Layout of the graph:\n    //\n    // 0 1 2 3 0 1 2 3\n    // - - - - - - - - (3)\n    // x x x x - - - - (2)\n    // x x x x - - - - (1)\n    // x x x x - - - - (0)\n    \n    // x is the part we need to compute, others are copied\n    // (0) will be copied to (3)\n    // the left x's will be copied to right\n\n    for(let i = 0; i < len0; ++i) {\n        graph[i] = new Array<number>()\n        for(let j = 0; j < len1; ++j) {\n            const a0 = (len0 + i - 1) % len0\n            const b0 = (a0 + 1) % len0\n            const c0 = (b0 + 1) % len0\n\n            const a1 = (len1 + j - 1) % len1\n            const b1 = (a1 + 1) % len1\n            const c1 = (b1 + 1) % len1\n\n            graph[i].push(1 - sim_t(w1, w2, \n                [T0[a0], T0[b0], T0[c0]],\n                [T1[a1], T1[b1], T1[c1]]\n                ))\n        }\n\n        graph[i].push(...graph[i])\n    }\n    graph.push(graph[0])\n    \n    let min = Infinity\n    let pathDir = new Array<DPDirection>()\n    let the_i = -1;\n\n    for(let i = 0; i < len0; ++i) {\n        const [this_min, this_pathDir] = dpMinPath(graph, {x:0, y:i}, {x:len0+1, y:i+len1+1});\n        if(min > this_min) {\n            the_i = i;\n            pathDir = this_pathDir;\n            min = this_min\n        }\n    }\n\n    // lookup table mapping T1 index to T0 index\n    const lookup = new Int32Array(len1)\n    let mapped = len0 - 1;\n    for(let i = 0; i < len1-1; ++i) {\n        const index = the_i + (len1-1-i)\n        lookup[index % len1] = mapped;\n        if(pathDir[i] === DPDirection.DownLeft) {\n            --mapped;\n            if(mapped < 0) {\n                break;\n            }\n        }\n        \n    }\n    lookup[the_i % len1] = 0\n\n    return lookup;\n}\n\n// Get angles of triangles\ntype AnglesOfTriangle  = [number, number, number]\nconst getTriAngles = (t: TriangleVec) : AnglesOfTriangle => {\n    const e0 = t[0].clone().sub(t[1])\n    const e1 = t[2].clone().sub(t[1])\n    const e2 = t[2].clone().sub(t[0])\n\n    const a1 = e0.angleTo(e1)\n    const a0 = e2.angleTo(e1)\n    const a2 = Math.PI - a1 - a0;\n    return [a0, a1, a2]\n}\n\nfunction smoothS(w1:number, w2: number, \n    t0: TriangleVec, t1: TriangleVec) {\n    let e = 0;\n    let a = 0;\n    for(let i = 0; i < 3; ++i) {\n         const e0 = t0[i].clone().sub(t0[(i+1)%3]).length()\n         const e1 = t1[i].clone().sub(t1[(i+1)%3]).length()\n         e += Math.abs(e0-e1) / (e0+e1)\n    }\n\n    const a0 = getTriAngles(t0)\n    const a1 = getTriAngles(t1)\n    for(let i = 0; i < 3; ++i) {\n        a += Math.abs(a0[i] - a1[i])\n    }\n    a /= Math.PI\n\n    return w1*(1-e)+w2*(1-a)\n}\n\nfunction bisect(t0:TriangleVec) {\n    return t0[0].clone().sub(t0[1]).add(\n        t0[2].clone().sub(t0[1])\n    )\n}\n\nfunction area(t0:TriangleVec) {\n    const v1 = t0[0].clone().sub(t0[1])\n    const v2 = t0[2].clone().sub(t0[1])\n    return Math.abs(0.5*v1.length() * v2.length() * Math.sin(v1.angleTo(v2)))\n}\n\n// see also: https://www.mathopenref.com/coordpolygonarea.html\nfunction polygonArea(poly:Vector3[]) {\n    let sum = 0\n    const end = poly.length - 1\n    for(let i = 0; i < end; ++i) {\n        sum += poly[i].x*poly[i+1].y - poly[i].y*poly[i+1].x\n    }\n    sum += poly[end].x*poly[0].y - poly[end].y*poly[0].x\n    sum /= 2\n    return Math.abs(sum)\n}\n\nfunction smooth_a(a:number, b:number, c:number, d: number, w1:number, w2: number, \n    poly_area_sum: number, t0: TriangleVec, t1: TriangleVec) {\n    const S = smoothS(w1, w2, t0, t1);\n    const R = bisect(t0).angleTo(bisect(t1))\n    const A = (area(t0) + area(t1)) / poly_area_sum\n    if (A < 1e-2) {\n        return -Infinity\n    }\n    return a * S + b * (1-R/Math.PI) + c * (A / (A+d))\n}\n/*\n\nfunction smoothKeyPoints(T0:Vector3[], T1:Vector3[], lookup: Int32Array, params:FuzzyParams) {\n    interface Smooth {\n        val: number\n        idx: number\n    };\n\n    const reverse_lookup = new Array<number>()\n    for(let i = 0; i < T1.length; ++i) {\n        reverse_lookup[lookup[i]] = i\n    }\n\n    const smooth = new Array<Smooth>();\n    const { smooth_a: a, smooth_b:b, smooth_c:c, smooth_w1: w1, smooth_w2: w2 } = params;\n\n    const area_sum = polygonArea(T0) + polygonArea(T1);\n\n    for(let i = 0; i < T0.length; ++i) {\n        const u0 = i;\n        const v0 = (i + 1) % T0.length;\n        const w0 = (i + 2) % T0.length;\n\n        const u = reverse_lookup[u0]\n        const v = reverse_lookup[v0]\n        const w = reverse_lookup[w0]\n        \n        const s = smooth_a(a, b, c, w1, w2, area_sum, \n            [T1[u], T1[v], T1[w]],\n            [T0[u0], T0[v0], T0[w0]]\n            );\n        //TODO: is idx `u` or `i`\n        smooth.push({\n            val: s,\n            idx: u\n        })\n    }\n\n    // sort in descending order\n    smooth.sort((a, b)=>(b.val - a.val))\n\n    return [ smooth[0].idx, smooth[1].idx, smooth[2].idx  ]\n}\n\n*/\nfunction smoothKeyPoints(T0:Vector3[], T1:Vector3[], lookup: Int32Array, params:FuzzyParams) {\n    interface Smooth {\n        val: number\n        idx: [number, number, number]\n    };\n\n    const reverse_lookup = new Array<number>()\n    for(let i = 0; i < T1.length; ++i) {\n        reverse_lookup[lookup[i]] = i\n    }\n\n    const smooth = new Array<Smooth>();\n    const { smooth_a: a, smooth_b:b, smooth_c:c, smooth_d:d, smooth_w1: w1, smooth_w2: w2 } = params;\n\n    const area_sum = polygonArea(T0) + polygonArea(T1);\n\n    for(let i = 0; i < T0.length; ++i) {\n        for(let j = 0; j < T0.length; ++j) {\n            for(let k = 0; k < T0.length; ++k) {\n                const u0 = i;\n                const v0 = j % T0.length;\n                const w0 = k % T0.length;\n\n                if(u0 === j || u0 === k || v0 === i || v0 === k || w0===i || w0 === j ){\n                    continue;\n                }\n                const u = reverse_lookup[u0]\n                const v = reverse_lookup[v0]\n                const w = reverse_lookup[w0]\n\n                const s = smooth_a(a, b, c, d, w1, w2, area_sum, \n                    [T1[u], T1[v], T1[w]],\n                    [T0[u0], T0[v0], T0[w0]]\n                    );\n                //TODO: is idx `u` or `i`\n            smooth.push({\n                val: s,\n                idx: [u, v, w]\n            })\n            }\n        }\n\n    }\n    // sort in descending order\n    smooth.sort((a, b)=>(b.val - a.val))\n    return smooth[0].idx\n}\n\nclass Mat2 {\n    // column major, in accordance with threejs\n    data = new Array<number>(4)\n    fromMatrix3(m: Matrix3) {\n        this.data[0] = m.elements[0]\n        this.data[1] = m.elements[1]\n        this.data[2] = m.elements[3]\n        this.data[3] = m.elements[4]\n        return this;\n    }\n\n    set(n11:number, n12:number, n21:number, n22:number) {\n        this.data[0] = n11; this.data[2] = n12;\n        this.data[1] = n21; this.data[3] = n22;\n        return this;\n    }\n\n    scaledIndentity(t:number) {\n        return this.set(\n            t, 0,\n            0, t\n        )\n    }\n\n    det() {\n        return (this.data[0] * this.data[3]) - (this.data[1] * this.data[2])\n    }\n\n    fromRotate(theta : number) {\n        const a = this.data\n        a[0] = Math.cos(theta)\n        a[1] = Math.sin(theta)\n        a[2] = -a[1]\n        a[3] = a[0]\n        return this;\n    }\n\n    apply2Vector3(v: Vector3) {\n        const x = v.x\n        const y = v.y\n        const a = this.data\n        v.x = a[0]*x + a[2]*y\n        v.y = a[1]*x + a[3]*y\n        return this;\n    }\n\n    // decompose to rotation theta & affine matrix\n    decompose() : [number, Mat2] {\n        // const det = this.det();\n        const sign = 1// Math.sign(det)\n\n        const B = new Mat2();\n        const b = B.data;\n        const a = this.data;\n\n        b[0] = sign * a[3] + a[0];\n        b[1] = - sign * a[2] + a[1];\n        b[2] = - sign * a[1] + a[2];\n        b[3] = sign * a[0] + a[3];\n        \n        const div = b[0]*b[0] + b[1]*b[1]\n        B.mulScalar(1/Math.sqrt(div))\n\n        const Bi = new Mat2().inv(B)\n        const C = new Mat2().mul(Bi, this)\n\n        \n        const cos = b[0]\n        const sin = b[1]\n        //const theta = Math.asin(sin)\n\n        //return [theta, C]\n        const ref = Math.asin(Math.abs(sin))\n        let theta = ref;\n        console.log('ref,', ref)\n        if(cos > 0 && sin > 0) {\n            theta = ref;\n        }\n        else if(sin > 0 && cos < 0) {\n            theta = Math.PI - theta\n        }\n        else if(sin < 0 && cos < 0) {\n            theta = Math.PI + theta\n        }\n        else if(sin < 0 && cos > 0) {\n            theta = Math.PI * 2 - theta\n        }\n        if(theta > Math.PI) {\n            theta -= 2*Math.PI\n        }\n        const U = new Mat2().fromRotate(theta);\n        const T = new Mat2().mul(U, C);\n        return [theta, C]\n    }\n\n    inv(M: Mat2) {\n        const det_ = 1 / M.det();\n        const a = this.data;\n        const m = M.data\n        a[0] = det_ * m[3]\n        a[1] = -det_ * m[1]\n        a[2] = -det_ * m[2]\n        a[3] = det_ * m[0]\n        return this;\n    }\n\n    // C = A x B\n    mul(A:Mat2, B:Mat2) {\n        const a = A.data\n        const b = B.data\n        const m = this.data\n\n        m[0] = a[0]*b[0] + a[2] * b[1]\n        m[1] = a[1]*b[0] + a[3]*b[1]\n        m[2] = a[0]*b[2] + a[2]*b[3]\n        m[3] = a[1]*b[2] + a[3]*b[3]\n        return this;\n    }\n\n    add(A:Mat2) {\n        const a = A.data\n        const m = this.data\n        m[0] += a[0];\n        m[1] += a[1];\n        m[2] += a[2];\n        m[3] += a[3];\n        return this;\n    }\n\n    clone() {\n        const m = new Mat2()\n        m.data = [...this.data]\n        return m\n    }\n\n    mulScalar(t : number) {\n        this.data[0] *= t;\n        this.data[1] *= t;\n        this.data[2] *= t;\n        this.data[3] *= t;\n        return this\n    }\n}\n\ninterface Trans {\n    raw_transform: Matrix3\n    translate: Vector2\n    theta: number\n    affine: Mat2\n    begin: Vector3\n}\n\nfunction computeTransform(from:TriangleVec, to: TriangleVec) : Trans {\n    const t2m = (t:TriangleVec) =>{\n        const mt = new Matrix3()\n        mt.set(\n            t[0].x, t[1].x, t[2].x,\n            t[0].y, t[1].y, t[2].y,\n            1,      1,      1\n        )\n        return mt;\n    }\n\n    let mFrom = t2m(from)\n    let mTo = t2m(to);\n    \n    // const inverse = new Matrix3().getInverse(mFrom)\n    const inverse = mFrom.clone().invert()\n    const transform = new Matrix3().multiplyMatrices(mTo, inverse);\n    \n    const translate = new Vector2(transform.elements[6], transform.elements[7])\n    const complex = new Mat2().fromMatrix3(transform)\n    const [theta, affine] = complex.decompose();\n    \n    return {\n        raw_transform: transform,\n        translate: translate,\n        theta: theta,\n        affine: affine,\n        begin: from[1].clone()\n    }\n}\n\n\nfunction global2LocalCoords(t: TriangleVec, vecs: Vector3[]) {\n    const B = t[1].clone()\n    const U = t[2].clone().sub(B)\n    const V = t[0].clone().sub(B)\n\n    const M = new Mat2().set(\n        U.x, V.x,\n        U.y, V.y\n    )\n    const Mi = new Mat2().inv(M)\n\n    B.z = 0\n    return vecs.map(i=>{\n        const v = i.clone().sub(B);\n        Mi.apply2Vector3(v)\n        return v;\n    });\n}\n\nfunction local2GlobalCoords(t: TriangleVec, vecs: Vector3[]) {\n    const B = t[1].clone()\n    const U = t[2].clone().sub(B)\n    const V = t[0].clone().sub(B)\n\n    const M = new Mat2().set(\n        U.x, V.x,\n        U.y, V.y\n    )\n\n    B.z = 0;\n    return vecs.map(i=>{\n        const v = i.clone()\n        M.apply2Vector3(v)\n        v.add(B)\n        return v\n    })\n}\n\n\nexport class FuzzyWarp {\n    // onto mapping from T1 to T0\n    lookup = new Int32Array()\n    keyPoints = new Array<number>()\n    T0_local = new Array<Vector3>()\n    T1_local = new Array<Vector3>()\n\n    //T1_to_T0 = new Array<Trans>()\n    //T0_to_T1 = new Array<Trans>()\n\n    Trans_T1_to_T0: Trans = {\n        translate: new Vector2(),\n        theta: 0,\n        affine: new Mat2(),\n        begin: new Vector3(),\n        raw_transform: new Matrix3()\n    }\n\n    // for debug purpose\n    T0 = new Array<Vector3>()\n    T1 = new Array<Vector3>()\n\n    referenceLocal: any = null\n\n    init(T0:Vector3[], T1:Vector3[], params: FuzzyParams) {\n        this.T0 = [...T0]\n        this.T1 = [...T1]\n\n        this.lookup = fuzzySimGraph(params.sim_w1, params.sim_w2, T0, T1);\n        this.keyPoints = smoothKeyPoints(T0, T1, this.lookup, params);\n\n        console.log('lookup', this.lookup)\n        console.log('key points', this.keyPoints)\n\n        let k = this.keyPoints\n        this.T1_local = global2LocalCoords(\n            [T1[k[0]], T1[k[1]], T1[k[2]]],\n            T1\n        )\n\n        k = this.keyPoints.map(v=>this.lookup[v])\n        this.T0_local = global2LocalCoords(\n            [T0[k[0]], T0[k[1]], T0[k[2]]],\n            T0\n        )\n        \n        this.referenceLocal = [T0[k[0]], T0[k[1]], T0[k[2]]]\n        const debug_T0_Global = local2GlobalCoords(\n            [T0[k[0]], T0[k[1]], T0[k[2]]],\n            this.T0_local\n        )\n        \n        const k1 = this.keyPoints\n        this.Trans_T1_to_T0 = computeTransform(\n            [T1[k1[0]], T1[k1[1]], T1[k1[2]]],\n            [T0[k[0]], T0[k[1]], T0[k[2]]]\n        )\n        \n        const t = 1;\n        const trans = this.Trans_T1_to_T0;\n        const A0 = new Mat2().scaledIndentity(1-t)\n        const B0 = new Mat2().fromRotate(t * trans.theta)\n        const C0 = trans.affine.clone().mulScalar(t)\n        const D0 = new Mat2().mul(B0, C0)\n        A0.add(D0)\n        const newGlobalCoords = this.keyPoints.map(v=>{\n            const i = this.T1[v].clone()\n            A0.apply2Vector3(i)\n            return i\n        })\n        \n        const added = newGlobalCoords.map(v=>{\n            const i =  v.clone()\n            i.add(new Vector3(trans.translate.x, trans.translate.y));\n            return i;\n        })\n\n        const debug_nde_ = this.keyPoints.map(v=>{\n            const i = this.T1[v].clone()\n            i.z = 1;\n            i.applyMatrix3(trans.raw_transform)\n            return i;\n        })\n\n        console.log(this.Trans_T1_to_T0)\n    }\n\n    private _interpLocal(t:number) {\n        return this.T1_local.map((v, idx)=>{\n            const v0 = v.clone().multiplyScalar(1-t).add(\n                this.T0_local[this.lookup[idx]].clone().multiplyScalar(t)\n            )\n            v0.z = v.z\n            return v0\n        })\n    }\n\n    interp(t: number) {\n        const trans = this.Trans_T1_to_T0 // this.T1_to_T0[1]\n\n        const A0 = new Mat2().scaledIndentity(1-t)\n        const B0 = new Mat2().fromRotate(t * trans.theta)\n        const C0 = trans.affine.clone().mulScalar(t)\n        const D0 = new Mat2().mul(B0, C0)\n        A0.add(D0)\n\n        const newGlobalCoords = this.keyPoints.map(v=>{\n            const i = this.T1[v].clone()\n            A0.apply2Vector3(i)\n            return i\n        })\n\n        for(let v of newGlobalCoords) {\n            v.add(new Vector3(trans.translate.x*t, trans.translate.y*t))\n        }\n\n        \n\n        //return local2GlobalCoords(\n        //    newGlobalCoords as TriangleVec,\n        //    this.T0_local\n        //)\n\n        return local2GlobalCoords(\n            newGlobalCoords as TriangleVec,\n            this._interpLocal(t)\n        )\n    }\n}\n\n// export function getDefaultFuzzyParams() : FuzzyParams {\n//     return{\n//         smooth_a: 0.2, // shape similarity\n//         smooth_b: 0.3, // min rotation\n//         smooth_c: 0.5, // max area coverage\n//         smooth_d: 2,\n//         smooth_w1: 0.5,\n//         smooth_w2: 0.5,\n\n\n//         sim_w1: 0.5,\n//         sim_w2: 0.5\n//     }\n// }\n\nexport function getDefaultFuzzyParams() : FuzzyParams {\n    return{\n        smooth_a: 0.4, // shape similarity\n        smooth_b: 0.4, // min rotation\n        smooth_c: 0.2, // max area coverage\n        smooth_d: 2,\n        smooth_w1: 0.5,\n        smooth_w2: 0.5,\n\n\n        sim_w1: 0.5,\n        sim_w2: 0.5\n    }\n}\n\nfunction AssertArrayEqual<T>(a: ArrayLike<T>, b: ArrayLike<T>) {\n    if(a.length !== b.length) {\n        throw \"Length no match\"\n    }\n    for(let i = 0; i < a.length; ++i) {\n        if(a[i] !== b[i]) {\n            throw `Mismatch at: ${i}`\n        }\n    }\n}\n\nexport const TestFuzzyGraph = ()=>{\n    const data = [\n        [-1.0, -1.0, 0],\n        [0, -0.9, 0],\n        [0, 0, 0],\n        [-1, 1, 0]\n    ]\n\n    const vdata = data.map(v=>new Vector3(...v))\n    const arr = new Array<number>()\n    const vdata2 = vdata.map(v=>{\n        const x = v.clone()\n        x.x += 2;\n        return x;\n    })\n    for(let i = 0; i < vdata.length; ++i) {\n        arr.push(i)\n    }\n\n    vdata2.push(vdata2.shift() as Vector3);\n    arr.push(arr.shift() as number);\n\n\n    const lookup = fuzzySimGraph(0.5, 0.5, vdata, vdata2)\n    AssertArrayEqual(lookup, arr)\n\n    const params = getDefaultFuzzyParams()\n    const keyPoints = smoothKeyPoints(vdata, vdata2, lookup, params)\n\n    const fuzzy = new FuzzyWarp();\n    fuzzy.init(vdata, vdata2, params)\n    fuzzy.interp(0.1);\n    fuzzy.interp(1);\n}\n\nconst Test = () => {\n    //TestFuzzyGraph()\n}\nexport { Test }","// import * as THREE from 'three'\n\n// import { MapColorToDiscrete, BeginingPrime, Integration, ComputeTransformMatrix } from './utils'\n\n\nexport class CanvasManager {\n    canvas = null\n    w = 0\n    h = 0\n    pickPosition = {\n        x: 0,\n        y: 0\n    }\n    frame = null\n\n    constructor(frame, canvas, render, onresize) {\n        this.clearPickPosition()\n        this.canvas = canvas\n        this.w = frame.clientWidth\n        this.h = frame.clientHeight\n        frame.appendChild(canvas)\n        frame.mouseout = ()=> this.clearPickPosition()\n        this.frame = frame\n        window.addEventListener('resize', (e)=>{\n            this.w = this.frame.clientWidth\n            this.h = this.frame.clientHeight\n            // render.setSize(this.w, this.h)\n            onresize(this.w, this.h)\n        })\n    }\n    \n    set onmousemove(fn) {\n        this.frame.onmousemove = fn\n    }\n\n    set onmousedown(fn) {\n        this.frame.onmousedown = fn\n    }\n\n    set onmouseup(fn) {\n        this.frame.onmouseup = fn\n    }\n\n    set onclick(fn) {\n        this.frame.onclick = fn\n    }\n\n    Aspect() {\n        return this.w / this.h\n    }\n\n    getCanvasRelativePosition(event) {\n        const rect = this.canvas.getBoundingClientRect();\n        return {\n          x: event.clientX - rect.left,\n          y: event.clientY - rect.top,\n        };\n    }\n\n    setPickPosition(event) {\n        let pickPosition = this.pickPosition\n        const pos = this.getCanvasRelativePosition(event);\n        pickPosition.x = (pos.x / this.w) *  2 - 1;\n        pickPosition.y = (pos.y / this.h) * -2 + 1;  // note we flip Y\n    }\n\n    clearPickPosition() {\n        let pickPosition = this.pickPosition\n        pickPosition.x = -100000;\n        pickPosition.y = -100000;\n    }\n}","import React, { useEffect, useState } from 'react'\nimport { CanvasManager } from './canvas'\nimport * as THREE from 'three'\n// import { TrackballControls } from './traceballctrl'\nimport { TrackballControls } from 'three/examples/jsm/controls/TrackballControls'\n// import { DragControls } from 'three/examples/jsm/controls/DragControls'\n\nimport {FuzzyWarp, getDefaultFuzzyParams, Test, FuzzyParams} from './algo'\nimport { Vector3 } from 'three'\n\ninterface RenderProps {\n    onHandle?: (x:any)=>any\n}\n\ninterface RenderSettingsProps {\n    handle?: ReturnType<typeof RunAll>\n}\n\nexport const RenderSettings : React.FC<RenderSettingsProps> = (props)=>{\n    const [params, setParams] = useState(getDefaultFuzzyParams())\n    const chParam = (k: keyof FuzzyParams)=>{\n        return (e:React.ChangeEvent<HTMLInputElement>)=>{\n            const res = parseFloat(e.target.value)\n            const nparam = { ...params }\n            if(k === 'sim_w1') {\n                nparam.sim_w1 = res\n                nparam.sim_w2 = 1 - res\n            }\n            if(k === 'smooth_w1') {\n                nparam.smooth_w1 = res\n                nparam.smooth_w2 = 1 - res\n            }\n            if(k === 'smooth_a' || k === 'smooth_b') {\n                nparam[k] = res\n                const c = nparam.smooth_a + nparam.smooth_b\n                if(c > 1) {\n                    return\n                }\n\n                else {\n                    nparam.smooth_c = 1 - c;\n                }\n            }\n            const rprams = {\n                ...nparam,\n                [k]: res\n            }\n            setParams(rprams)\n            if(props.handle) {\n                props.handle.setDefaultParameter(rprams)\n            }\n        }\n    }\n\n    return (\n        <div>\n        <h4>Fuzzy polygon similarity</h4>\n        <table>\n            <tr><td><span>&omega; <sub>1</sub> (match size) </span></td>\n                <td><input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" defaultValue={params.sim_w1} onChange={chParam('sim_w1')} ></input> {params.sim_w1} </td>\n            </tr>\n            <tr><td><span>&omega; <sub>2</sub> (match shape)</span></td>\n                <td><input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" value={params.sim_w2} readOnly></input> {params.sim_w2} </td>\n            </tr>\n        </table>\n        \n        <p></p>\n        <p></p>\n        <h4>Affine Transform Smooth Param</h4>\n        <h5>Similarity Degree</h5>\n        <table>\n            <tr><td><span>&omega; <sub>1</sub> (match size) </span></td>\n                <td><input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" defaultValue={params.smooth_w1} onChange={chParam('smooth_w1')} ></input> {params.smooth_w1} </td>\n            </tr>\n            <tr><td><span>&omega; <sub>2</sub> (match shape)</span></td>\n                <td><input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" value={params.smooth_w2} readOnly></input> {params.smooth_w2.toFixed(2)} </td>\n            </tr>\n        </table>\n        <p></p>\n        <h5>Smooth</h5>\n        <table>\n        <tr><td><span>smooth<sub>a</sub> (match similarity) </span> </td><td> <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" value={params.smooth_a} onChange={chParam('smooth_a')} ></input> {params.smooth_a} </td></tr>\n        <tr><td><span>smooth<sub>b</sub> (minimize rotation) </span></td><td> <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" value={params.smooth_b} onChange={chParam('smooth_b')}></input>  {params.smooth_b} </td></tr>\n        <tr><td><span>smooth<sub>c</sub> (minimize area) </span>    </td><td> <input type=\"range\" min=\"0\" max=\"1\" step=\"0.01\" value={params.smooth_c} readOnly></input>             {params.smooth_c.toFixed(2)} </td></tr>\n        <tr><td><span>smooth<sub>d</sub> (adjust) </span>           </td><td> <input type=\"range\" min=\"0\" max=\"20\" step=\"0.1\" value={params.smooth_d} onChange={chParam('smooth_d')}></input>  {params.smooth_d} </td></tr>\n        </table>\n        </div>\n    )\n}\n\nconst Render : React.FC<RenderProps> = (props)=>{\n    const [handle, setHandle] = useState<ReturnType<typeof RunAll>>()\n    const [useWhat, setUseWhat] = useState('A')\n    \n\n    useEffect(()=>{\n        const h = RunAll()\n        setHandle(h)\n        if(props.onHandle) {\n            props.onHandle(h)\n        }\n    }, [])\n    \n    const next = () =>{\n        if(handle) {\n            setUseWhat(handle.next());\n        }\n    }\n\n    const transform = () =>{\n        if(handle) {\n            handle.transform();\n        }\n    }\n\n    return (<div>\n        using: {useWhat}\n        <button onClick={next}>\n        Toggle\n      </button>\n      <button onClick={transform}>\n        Transform\n      </button>\n      \n    </div>)\n}\n\nexport default Render;\n\n\n\nfunction RunAll () {\nconst HandleResize = ()=>{Resize()}\nconst frame = document.getElementById('canvas-frame'); if(frame === null) return;\nconst scene = new THREE.Scene();\nconst renderer = new THREE.WebGLRenderer({antialias : true, powerPreference:'high-performance'});\nconst canvas = new CanvasManager(frame, renderer.domElement, renderer, HandleResize);\nconst camera = new THREE.PerspectiveCamera(75, canvas.Aspect(), 0.1, 1000);\n\nrenderer.setSize(canvas.w, canvas.h);\nrenderer.setClearColor(0x444444, 1.0);\nrenderer.setPixelRatio(window.devicePixelRatio)\n\ncamera.position.z = 5;\nvar Resize=() => {\n    console.log(canvas.w, canvas.h)\n    // camera.aspect = canvas.Aspect()\n    // camera.updateMatrix()\n}\nconst control = new TrackballControls(camera, frame)\n// const fpControl = new KeyControls(camera, frame)\ncontrol.target.set(0, 0, 0)\ncontrol.rotateSpeed = 8.0;\ncontrol.noPan = false\ncontrol.maxDistance = 60\ncontrol.keys = []\nconst ambientLight = new THREE.AmbientLight( 0x404040 ); // soft white light\nscene.add( ambientLight );\nvar light = new THREE.PointLight( 0xffffff, 1, 100 );\nlight.position.set( 10, 10, 10 );\nscene.add( light );\n\nvar plight = new THREE.PointLight( 0xffffff, 1, 200 );\nplight.position.set( -40, 20, 20 );\nscene.add( plight );\n\nvar light1 = new THREE.PointLight( 0xffffff, 1, 200 );\nlight1.position.set( -40, -20, -20 );\nscene.add( light1 );\n\nvar light2 = new THREE.PointLight( 0xffffff, 1, 200 );\nlight2.position.set( -20, 10, -10 );\nscene.add( light2 );\n\n\nconst fuzzyWarper = new FuzzyWarp();\n\nconst planegeo = new THREE.PlaneGeometry( 1000, 1000, 10, 10 );\nconst planeMesh = new THREE.Mesh(planegeo, new THREE.MeshBasicMaterial());\nplaneMesh.position.set(0, 0, 0)\nconst click_raycaster = new THREE.Raycaster();\n\nconst GetMouseOnPlane = () => {\n    let point = new THREE.Vector3(canvas.pickPosition.x, canvas.pickPosition.y, 5);\n    click_raycaster.setFromCamera(point, camera);\n    let hits = click_raycaster.intersectObject(planeMesh,true);\n    return hits[0].point;\n}\n\nconst dotsGroup = new THREE.Group();\nscene.add(dotsGroup)\n\n\nconst makeLineFromVertices = (v : Vector3[]) => {\n    const A_lineGeo = new THREE.Geometry();\n    A_lineGeo.vertices = v;\n    const A_lineMaterial = new THREE.LineBasicMaterial({ color: 0xffffff,  linewidth: 1})\n    return new THREE.Line(A_lineGeo, A_lineMaterial);\n}\n\nlet A_vertices = new Array<Vector3>()\nlet A_line = makeLineFromVertices(A_vertices)\nlet B_vertices = new Array<Vector3>()\nlet B_line = makeLineFromVertices(B_vertices)\n\nscene.add(A_line)\n\nlet useAorB = false\n\ncanvas.onclick = (event : any)=>{\n    canvas.setPickPosition(event);\n    const pointOnPlane = GetMouseOnPlane();\n    pointOnPlane.z = 0\n    \n    if(Math.abs(pointOnPlane.y) > 3.71) {\n        return;\n    }\n\n    // console.log(pointOnPlane)\n    if(!useAorB) {\n        A_vertices.push(pointOnPlane)\n        scene.remove(A_line)\n        A_line = makeLineFromVertices(A_vertices)\n        scene.add(A_line)\n    }\n    else {\n        B_vertices.push(pointOnPlane)\n        scene.remove(B_line)\n        B_line = makeLineFromVertices(B_vertices)\n        scene.add(B_line)\n    }\n    \n    /*\n    let pointGeo = new THREE.CircleGeometry( 0.05, 12 );\n    let dotMaterial = new THREE.MeshBasicMaterial( { color: 0xffffff } );\n    let dot = new THREE.Mesh( pointGeo, dotMaterial );\n    dot.position.set(pointOnPlane.x, pointOnPlane.y, pointOnPlane.z)\n    dot.userData = { id: dotsGroup.children.length }\n    dotsGroup.add( dot );*/\n}\n\n\nlet isTransforming = false\nlet time = 0\nconst deltaTime = 0.01\n// const deltaTime = 0.25\nlet middle = makeLineFromVertices(new Array<Vector3>())\nscene.add(middle)\n\nfunction render() {\n    requestAnimationFrame(render);\n    renderer.render(scene, camera);\n    if(isTransforming) {\n        if(time > 1) {\n            isTransforming = false\n        }\n        else {\n            time += deltaTime\n            scene.remove(middle)\n            const inted = fuzzyWarper.interp(time)\n            inted.push(inted[0])\n            middle = makeLineFromVertices(inted)\n            scene.add(middle)\n        }\n\n    }\n}\n\nconst keyPoints = new THREE.Group()\nscene.add(keyPoints)\n\nconst addDots = (vec : Vector3[]) => {\n    [0xff0000, 0x00ff00, 0x0000ff].forEach((v, idx)=>{\n        const mat = new THREE.MeshBasicMaterial({color: v});\n        const geo = new THREE.CircleGeometry(0.06, 10)\n        const c = new THREE.Mesh(geo, mat);\n        c.position.set(vec[idx].x, vec[idx].y, vec[idx].z);\n        keyPoints.add(c)\n    })\n}\n\nlet defaultFuzzyParams = getDefaultFuzzyParams()\n\nconst triggerTransform = (params?: FuzzyParams)=>{\n    if(A_vertices.length > B_vertices.length) {\n        const T = A_vertices;\n        A_vertices = B_vertices;\n        B_vertices = T;\n    }\n    keyPoints.clear()\n    fuzzyWarper.init(A_vertices, B_vertices, params || defaultFuzzyParams)\n    addDots(fuzzyWarper.keyPoints.map(v=>{\n        return B_vertices[v]\n    }))\n\n    addDots(fuzzyWarper.keyPoints.map(v=>{\n        return A_vertices[fuzzyWarper.lookup[v]]\n    }))\n\n    isTransforming = true\n    time = 0\n\n}\n\nrender();\n\nTest()\n\nreturn {\n    next: ()=>{ useAorB = !useAorB; return useAorB? 'B' : 'A'  },\n    transform: (params?: FuzzyParams)=>{ triggerTransform(params) },\n    setDefaultParameter: (x:FuzzyParams) => { defaultFuzzyParams = x }\n}\n\n\n}","\nimport React from 'react'\nimport './personal_page.css'\n\n\nconst PersonalPage:React.FC = () =>{\n    return (\n        <a href='https://linwe2012.github.io/personal-page'>\n        <div className='personal-page-wrap-white'>\n            <img className='personal-page-avatar-white' src='https://linwe2012.github.io/personal-page/static/img/me-removebg-preview-sqr.svg' alt=''></img>\n            <div className='personal-page-text-white'>Lin's Personal Page</div>\n        </div>\n        </a>\n    )\n}\n\nexport default PersonalPage;","import React, {useState} from 'react';\nimport './App.css';\nimport Render, { RenderSettings } from './render';\n\nimport PersonalPage from './personal_page'\n\nconst App: React.FC = () => {\n  const [handle, setHandle] = useState<any>(undefined)\n  \n  return (\n    <div className=\"App\" style={{display:'flex'}}>\n      <div className=\"canvas\" id=\"canvas-frame\" style={{\n        width: 800,\n        height: 600\n      }}>\n        <Render onHandle={(h)=>setHandle(h)}>\n\n        </Render>\n      </div>\n      <div style={{marginLeft: 10, textAlign: 'left'}}>\n      <a href='https://github.com/linwe2012/FuzzyWarp'>Github Source Code</a> <span> &nbsp; &nbsp; </span>\n      <a href='https://ieeexplore.ieee.org/abstract/document/511850'>Paper on IEEE</a> <br/>\n      <a href='https://github.com/linwe2012/FuzzyWarp/blob/master/docs/FuzzyApproach.pdf'>[PDF] A fuzzy approach to digital image warping</a>\n      <h3>Usage: </h3>\n      <li> Click on the gray area to make 1st shape </li>\n      <li> Click toggle button, then you can make 2nd shape </li>\n      <li> Click tranform to see the animation </li>\n\n      <li> refresh page to try new transfroms </li>\n\n      <div className='seperator'></div>\n      <h3>Parameters: </h3>\n      <RenderSettings handle={handle}></RenderSettings>\n      <div className='seperator'></div>\n      <h3> Note: </h3>\n      <li> The 3 dots, blue, green, red indicates the reference points, This can be changed via Fuzzy polygon similarity. </li>\n      <p></p>\n      <PersonalPage/>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}