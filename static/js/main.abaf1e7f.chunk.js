(this["webpackJsonpfuzzy-warp"]=this["webpackJsonpfuzzy-warp"]||[]).push([[0],{11:function(t,n,e){t.exports=e(18)},16:function(t,n,e){},17:function(t,n,e){},18:function(t,n,e){"use strict";e.r(n);var a,r=e(1),o=e.n(r),i=e(8),s=e.n(i),c=(e(16),e(17),e(3)),u=e(2),l=e(5),h=function(){function t(n,e,a,r){var o=this;Object(u.a)(this,t),this.canvas=null,this.w=0,this.h=0,this.pickPosition={x:0,y:0},this.frame=null,this.clearPickPosition(),this.canvas=e,this.w=n.clientWidth,this.h=n.clientHeight,n.appendChild(e),n.mouseout=function(){return o.clearPickPosition()},this.frame=n,window.addEventListener("resize",function(t){o.w=o.frame.clientWidth,o.h=o.frame.clientHeight,r(o.w,o.h)})}return Object(l.a)(t,[{key:"Aspect",value:function(){return this.w/this.h}},{key:"getCanvasRelativePosition",value:function(t){var n=this.canvas.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}},{key:"setPickPosition",value:function(t){var n=this.pickPosition,e=this.getCanvasRelativePosition(t);n.x=e.x/this.w*2-1,n.y=e.y/this.h*-2+1}},{key:"clearPickPosition",value:function(){var t=this.pickPosition;t.x=-1e5,t.y=-1e5}},{key:"onmousemove",set:function(t){this.frame.onmousemove=t}},{key:"onmousedown",set:function(t){this.frame.onmousedown=t}},{key:"onmouseup",set:function(t){this.frame.onmouseup=t}},{key:"onclick",set:function(t){this.frame.onclick=t}}]),t}(),f=e(0),v=e(9),d=(e(10),e(4));function y(t,n,e,a){var r=e[0].clone().sub(e[1]),o=e[2].clone().sub(e[1]),i=a[0].clone().sub(a[1]),s=a[2].clone().sub(a[1]),c=r.angleTo(o),u=i.angleTo(s),l=r.length()*s.length(),h=i.length()*o.length();return t*(1-Math.abs(l-h)/(l+h))+n*(1-Math.abs(c-u)/2/Math.PI)}function w(t,n,e){var r=e.x-n.x,o=e.y-n.y,i=new Array;i[0]=new Array,i[0].push({dir:a.Start,cost:t[n.x][n.y]});for(var s=i[0][0].cost,c=1;c<o;++c)s+=t[n.x][n.y+c],i[0].push({dir:a.Start,cost:s});for(var u=1;u<r;++u){i[u]=new Array,i[u].push({dir:a.Start,cost:1/0});for(var l=1;l<o;++l){var h=i[u][l-1].cost,f=i[u-1][l-1].cost,v=t[n.x+u][n.y+l];h<f?i[u].push({dir:a.Left,cost:h+v}):i[u].push({dir:a.DownLeft,cost:f+v})}}for(var d=new Array,y={x:r-1,y:o-1},w=i[y.x][y.y].cost;(y.y||y.x!==n.x)&&(d.push(i[y.x][y.y].dir),i[y.x][y.y].dir===a.Left?--y.y:(--y.x,--y.y),i[y.x][y.y].dir!==a.Start););return d.shift(),[w,d]}function m(t,n,e,r){for(var o=e.length,i=r.length,s=new Array,u=0;u<o;++u){var l;s[u]=new Array;for(var h=0;h<i;++h){var f=(o+u-1)%o,v=(f+1)%o,m=(v+1)%o,p=(i+h-1)%i,k=(p+1)%i,b=(k+1)%i;s[u].push(1-y(t,n,[e[f],e[v],e[m]],[r[p],r[k],r[b]]))}(l=s[u]).push.apply(l,Object(d.a)(s[u]))}s.push(s[0]);for(var g=1/0,x=new Array,_=-1,P=0;P<o;++P){var T=w(s,{x:0,y:P},{x:o+1,y:P+i+1}),A=Object(c.a)(T,2),M=A[0],j=A[1];g>M&&(_=P,x=j,g=M)}for(var O=new Int32Array(i),I=o-1,S=0;S<i-1;++S){if(O[(_+(i-1-S))%i]=I,x[S]===a.DownLeft&&--I<0)break}return O[_%i]=0,O}!function(t){t[t.Left=0]="Left",t[t.DownLeft=1]="DownLeft",t[t.Start=2]="Start"}(a||(a={}));var p=function(t){var n=t[0].clone().sub(t[1]),e=t[2].clone().sub(t[1]),a=t[2].clone().sub(t[0]),r=n.angleTo(e),o=a.angleTo(e);return[o,r,Math.PI-r-o]};function k(t){return t[0].clone().sub(t[1]).add(t[2].clone().sub(t[1]))}function b(t){var n=t[0].clone().sub(t[1]),e=t[2].clone().sub(t[1]);return Math.abs(.5*n.length()*e.length()*Math.sin(n.angleTo(e)))}function g(t){for(var n=0,e=t.length-1,a=0;a<e;++a)n+=t[a].x*t[a+1].y-t[a].y*t[a+1].x;return n+=t[e].x*t[0].y-t[e].y*t[0].x,n/=2,Math.abs(n)}function x(t,n,e,a,r,o,i,s){var c=function(t,n,e,a){for(var r=0,o=0,i=0;i<3;++i){var s=e[i].clone().sub(e[(i+1)%3]).length(),c=a[i].clone().sub(a[(i+1)%3]).length();r+=Math.abs(s-c)/(s+c)}for(var u=p(e),l=p(a),h=0;h<3;++h)o+=Math.abs(u[h]-l[h]);return t*(1-r)+n*(1-(o/=Math.PI))}(a,r,i,s),u=k(i).angleTo(k(s)),l=(b(i)+b(s))/o;return l<.01?-1/0:t*c+n*(1-u/Math.PI)+e*l}function _(t,n,e,a){for(var r=new Array,o=0;o<n.length;++o)r[e[o]]=o;for(var i=new Array,s=a.smooth_a,c=a.smooth_b,u=a.smooth_c,l=a.smooth_w1,h=a.smooth_w2,f=g(t)+g(n),v=0;v<t.length;++v)for(var d=0;d<t.length;++d)for(var y=0;y<t.length;++y){var w=v,m=d%t.length,p=y%t.length;if(w!=d&&w!=y&&m!=v&&m!=y&&p!=v&&p!=d){var k=r[w],b=r[m],_=r[p],P=x(s,c,u,l,h,f,[n[k],n[b],n[_]],[t[w],t[m],t[p]]);i.push({val:P,idx:[k,b,_]})}}return i.sort(function(t,n){return n.val-t.val}),i[0].idx}var P=function(){function t(){Object(u.a)(this,t),this.data=new Array(4)}return Object(l.a)(t,[{key:"fromMatrix3",value:function(t){return this.data[0]=t.elements[0],this.data[1]=t.elements[1],this.data[2]=t.elements[3],this.data[3]=t.elements[4],this}},{key:"set",value:function(t,n,e,a){return this.data[0]=t,this.data[2]=n,this.data[1]=e,this.data[3]=a,this}},{key:"scaledIndentity",value:function(t){return this.set(t,0,0,t)}},{key:"det",value:function(){return this.data[0]*this.data[3]-this.data[1]*this.data[2]}},{key:"fromRotate",value:function(t){var n=this.data;return n[0]=Math.cos(t),n[1]=Math.sin(t),n[2]=-n[1],n[3]=n[0],this}},{key:"apply2Vector3",value:function(t){var n=t.x,e=t.y,a=this.data;return t.x=a[0]*n+a[2]*e,t.y=a[1]*n+a[3]*e,this}},{key:"decompose",value:function(){this.det();var n=new t,e=n.data,a=this.data;e[0]=1*a[3]+a[0],e[1]=-1*a[2]+a[1],e[2]=-1*a[1]+a[2],e[3]=1*a[0]+a[3];var r=e[0]*e[0]+e[1]*e[1];n.mulScalar(1/Math.sqrt(r));var o=(new t).inv(n),i=(new t).mul(o,this),s=e[0],c=e[1],u=Math.asin(Math.abs(c)),l=u;console.log("ref,",u),s>0&&c>0?l=u:c>0&&s<0?l=Math.PI-l:c<0&&s<0?l=Math.PI+l:c<0&&s>0&&(l=2*Math.PI-l),l>Math.PI&&(l-=2*Math.PI);var h=(new t).fromRotate(l);(new t).mul(h,i);return[l,i]}},{key:"inv",value:function(t){var n=1/t.det(),e=this.data,a=t.data;return e[0]=n*a[3],e[1]=-n*a[1],e[2]=-n*a[2],e[3]=n*a[0],this}},{key:"mul",value:function(t,n){var e=t.data,a=n.data,r=this.data;return r[0]=e[0]*a[0]+e[2]*a[1],r[1]=e[1]*a[0]+e[3]*a[1],r[2]=e[0]*a[2]+e[2]*a[3],r[3]=e[1]*a[2]+e[3]*a[3],this}},{key:"add",value:function(t){var n=t.data,e=this.data;return e[0]+=n[0],e[1]+=n[1],e[2]+=n[2],e[3]+=n[3],this}},{key:"clone",value:function(){var n=new t;return n.data=Object(d.a)(this.data),n}},{key:"mulScalar",value:function(t){return this.data[0]*=t,this.data[1]*=t,this.data[2]*=t,this.data[3]*=t,this}}]),t}();function T(t,n){var e=t[1].clone(),a=t[2].clone().sub(e),r=t[0].clone().sub(e),o=(new P).set(a.x,r.x,a.y,r.y),i=(new P).inv(o);return e.z=0,n.map(function(t){var n=t.clone().sub(e);return i.apply2Vector3(n),n})}function A(t,n){var e=t[1].clone(),a=t[2].clone().sub(e),r=t[0].clone().sub(e),o=(new P).set(a.x,r.x,a.y,r.y);return e.z=0,n.map(function(t){var n=t.clone();return o.apply2Vector3(n),n.add(e),n})}var M=function(){function t(){Object(u.a)(this,t),this.lookup=new Int32Array,this.keyPoints=new Array,this.T0_local=new Array,this.T1_local=new Array,this.Trans_T1_to_T0={translate:new f.r,theta:0,affine:new P,begin:new f.s,raw_transform:new f.i},this.T0=new Array,this.T1=new Array,this.referenceLocal=null}return Object(l.a)(t,[{key:"init",value:function(t,n,e){var a=this;this.T0=Object(d.a)(t),this.T1=Object(d.a)(n),this.lookup=m(e.sim_w1,e.sim_w2,t,n),this.keyPoints=_(t,n,this.lookup,e),console.log("lookup",this.lookup),console.log("key points",this.keyPoints);var r=this.keyPoints;this.T1_local=T([n[r[0]],n[r[1]],n[r[2]]],n),r=this.keyPoints.map(function(t){return a.lookup[t]}),this.T0_local=T([t[r[0]],t[r[1]],t[r[2]]],t),this.referenceLocal=[t[r[0]],t[r[1]],t[r[2]]];A([t[r[0]],t[r[1]],t[r[2]]],this.T0_local);var o=this.keyPoints;this.Trans_T1_to_T0=function(t,n){var e=function(t){var n=new f.i;return n.set(t[0].x,t[1].x,t[2].x,t[0].y,t[1].y,t[2].y,1,1,1),n},a=e(t),r=e(n),o=(new f.i).getInverse(a),i=(new f.i).multiplyMatrices(r,o),s=new f.r(i.elements[6],i.elements[7]),u=(new P).fromMatrix3(i).decompose(),l=Object(c.a)(u,2);return{raw_transform:i,translate:s,theta:l[0],affine:l[1],begin:t[1].clone()}}([n[o[0]],n[o[1]],n[o[2]]],[t[r[0]],t[r[1]],t[r[2]]]);var i=this.Trans_T1_to_T0,s=(new P).scaledIndentity(0),u=(new P).fromRotate(1*i.theta),l=i.affine.clone().mulScalar(1),h=(new P).mul(u,l);s.add(h);this.keyPoints.map(function(t){var n=a.T1[t].clone();return s.apply2Vector3(n),n}).map(function(t){var n=t.clone();return n.add(new f.s(i.translate.x,i.translate.y)),n}),this.keyPoints.map(function(t){var n=a.T1[t].clone();return n.z=1,n.applyMatrix3(i.raw_transform),n});console.log(this.Trans_T1_to_T0)}},{key:"_interpLocal",value:function(t){var n=this;return this.T1_local.map(function(e,a){var r=e.clone().multiplyScalar(1-t).add(n.T0_local[n.lookup[a]].clone().multiplyScalar(t));return r.z=e.z,r})}},{key:"interp",value:function(t){var n=this,e=this.Trans_T1_to_T0,a=(new P).scaledIndentity(1-t),r=(new P).fromRotate(t*e.theta),o=e.affine.clone().mulScalar(t),i=(new P).mul(r,o);a.add(i);var s=this.keyPoints.map(function(t){var e=n.T1[t].clone();return a.apply2Vector3(e),e}),c=!0,u=!1,l=void 0;try{for(var h,v=s[Symbol.iterator]();!(c=(h=v.next()).done);c=!0){h.value.add(new f.s(e.translate.x*t,e.translate.y*t))}}catch(d){u=!0,l=d}finally{try{c||null==v.return||v.return()}finally{if(u)throw l}}return A(s,this._interpLocal(t))}}]),t}();var j=function(){},O=function(t){var n=Object(r.useState)(),e=Object(c.a)(n,2),a=e[0],i=e[1],s=Object(r.useState)("A"),u=Object(c.a)(s,2),l=u[0],d=u[1];Object(r.useEffect)(function(){i(function(){var t=document.getElementById("canvas-frame");if(null===t)return;var n=new f.q,e=new f.t({antialias:!0,powerPreference:"high-performance"}),a=new h(t,e.domElement,e,function(){o()}),r=new f.l(75,a.Aspect(),.1,1e3);e.setSize(a.w,a.h),e.setClearColor(4473924,1),r.position.z=5;var o=function(){console.log(a.w,a.h)},i=new v.a(r,t);i.target.set(0,0,0),i.rotateSpeed=8,i.noPan=!1,i.maxDistance=60,i.keys=[];var s=new f.a(4210752);n.add(s);var c=new f.n(16777215,1,100);c.position.set(10,10,10),n.add(c);var u=new f.n(16777215,1,200);u.position.set(-40,20,20),n.add(u);var l=new f.n(16777215,1,200);l.position.set(-40,-20,-20),n.add(l);var d=new f.n(16777215,1,200);d.position.set(-20,10,-10),n.add(d);var y=new M,w=new f.m(1e3,1e3,10,10),m=new f.j(w,new f.k);m.position.set(0,0,0);var p=new f.p,k=new f.e;n.add(k);var b=function(t){var n=new f.d;n.vertices=t;var e=new f.g({color:16777215,linewidth:1});return new f.f(n,e)},g=new Array,x=b(g),_=new Array,P=b(_);n.add(x);var T=!1;a.onclick=function(t){a.setPickPosition(t);var e=function(){var t=new f.s(a.pickPosition.x,a.pickPosition.y,5);return p.setFromCamera(t,r),p.intersectObject(m,!0)[0].point}();e.z=0,Math.abs(e.y)>3.71||(T?(_.push(e),n.remove(P),P=b(_),n.add(P)):(g.push(e),n.remove(x),x=b(g),n.add(x)))};var A=!1,O=0,I=.01,S=b(new Array);n.add(S);var z=new f.e;n.add(z);var L=function(t){[16711680,65280,255].map(function(n,e){var a=new f.k({color:n}),r=new f.b(.06,10),o=new f.j(r,a);o.position.set(t[e].x,t[e].y,t[e].z),z.add(o)})};return function t(){requestAnimationFrame(t);e.render(n,r);if(A)if(O>1)A=!1;else{O+=I,n.remove(S);var a=y.interp(O);a.push(a[0]),S=b(a),n.add(S)}}(),j(),{next:function(){return(T=!T)?"B":"A"},transform:function(){y.init(g,_,{smooth_a:.2,smooth_b:.3,smooth_c:.5,smooth_w1:.5,smooth_w2:.5,sim_w1:.5,sim_w2:.5}),L(y.keyPoints.map(function(t){return _[t]})),L(y.keyPoints.map(function(t){return g[y.lookup[t]]})),A=!0,O=0}}}())},[]);return o.a.createElement("div",null,"using: ",l,o.a.createElement("button",{onClick:function(){a&&d(a.next())}},"Toggle"),o.a.createElement("button",{onClick:function(){a&&a.transform()}},"Transform"))};var I=function(){return o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"canvas",id:"canvas-frame",style:{width:800,height:600}},o.a.createElement(O,null)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(o.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[11,1,2]]]);
//# sourceMappingURL=main.abaf1e7f.chunk.js.map